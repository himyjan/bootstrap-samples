@page
@model Bootstrap5ModalExample.Pages.Dialog2Model
@{
}
<style>
    .bar{}
</style>

@*
    The base code same from https://www.codeply.com/go/NCsThOAy3V/bootstrap-wait-modal-progress-bar
    and needed a lot of modifications to work, guessing it was done in an earlier version of BootStrap.
*@
<div class="container">
    <h1 class="fs-5">Modal with progress bar</h1>
    <button id="btn-confirm" role="button" class="btn btn-primary" data-toggle="modal">Submit</button>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="modalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title in fs-5" id="modalLabel">Please Wait</h1>
            </div>
            <div class="modal-body">
                <div class="progress">
                    <div class="progress-bar bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
                    </div>
                </div>
            </div>
            <div class="modal-footer text-center">
                <div class="me-auto fs-6 text-muted">Saving changes</div>
            </div>
        </div>
    </div>
</div>

@section Scripts
    {
    <script>

        var progressModal = new bootstrap.Modal(document.getElementById('myModal'),
            {
                backdrop: 'static',
                keyboard: false,
                show: false
            });

        document.getElementById("btn-confirm").addEventListener("click", function () {
            var $bar = $('.bar');
            $bar.width(0);
            var progress = setInterval(function () {
                
                $("#myModal").modal('show');

                console.log($bar.width());
                if ($bar.width() > 466) {
                    // complete!
                    // reset progress bar
                    clearInterval(progress);
                    $('.progress').removeClass('active');
                    //$bar.width(0);

                    // update modal
                    //$('#myModal .modal-body').html('Task complete. You can now close the modal.');
                    //$('#myModal .hide,#myModal .in').toggleClass('hide in');

                    // re-enable modal allowing close
                    $('#myModal').data('reenable', true);
                    $('#myModal').modal('hide');
                } else {

                    // perform processing logic (ajax) here
                    $bar.width(parseInt($bar.width()) + 10);
                }

                //$bar.text($bar.width()/5 + "%");
            }, 600);
        });

        $("#modal-btn-no").on("click", function () {
            $('#myModal .hide,#myModal .in').toggleClass('hide in');
            $("#myModal").modal('hide');
        });

        $('#myModal').on('hidden.bs.modal', function () {
            // reset modal
            console.log('reset modal');
            if ($('#myModal').data('reenable')) {
                $(this).removeData();
                $('#myModal').modal({
                    show: true
                });
            }
        });
    </script>
}
